#parameters:
#    swp.model.user.class: 'SWP\Bundle\UserBundle\Model\User'
parameters:
    swp_user.registration.confirmation.template : 'email.txt.twig'
    swp_user.registration.confirmation.from_email : 'test.html.twig'
    swp_user.resetting.email.template : 'test.html.twig'
    swp_user.resetting.email.from_email : 'test.html.twig'
    swp_user.firewall_name: 'default'

services:
    _defaults:
        autowire: true
        autoconfigure: true

    swp_user.form.registration_type:
        class: SWP\Bundle\UserBundle\Form\Type\RegistrationFormType
        arguments:
            - '%swp.model.user.class%'
        tags:
            - { name: form.type }

    SWP\Bundle\UserBundle\Model\UserManagerInterface: '@SWP\Bundle\UserBundle\Doctrine\UserManager'
    SWP\Bundle\UserBundle\Util\CanonicalizerInterface: '@SWP\Bundle\UserBundle\Util\Canonicalizer'

    SWP\Bundle\UserBundle\Util\Canonicalizer: ~

    SWP\Bundle\UserBundle\Doctrine\UserManager:
        arguments:
            - '@SWP\Bundle\UserBundle\Util\PasswordUpdater'
            - '@SWP\Bundle\UserBundle\Util\CanonicalFieldsUpdater'
            - '@swp.object_manager.user'
            - '%swp.model.user.class%'
#            - 'SWP\Bundle\UserBundle\Model\User'


    SWP\Bundle\UserBundle\Util\PasswordUpdater:
        arguments:
            - '@Symfony\Component\Security\Core\Encoder\EncoderFactoryInterface'

    SWP\Bundle\UserBundle\Util\CanonicalFieldsUpdater:
        arguments:
            - '@SWP\Bundle\UserBundle\Util\CanonicalizerInterface'
            - '@SWP\Bundle\UserBundle\Util\CanonicalizerInterface'

    SWP\Bundle\UserBundle\Doctrine\UserListener:
        arguments:
            - '@SWP\Bundle\UserBundle\Util\PasswordUpdater'
            - '@SWP\Bundle\UserBundle\Util\CanonicalFieldsUpdater'
        tags:
            - { name: doctrine.event_subscriber, connection: default }

    SWP\Bundle\UserBundle\Util\UserManipulator: ~

    SWP\Bundle\UserBundle\EventListener\EmailConfirmationListener:
        arguments: ~
        tags:
            - { name: kernel.event_subscriber }

    SWP\Bundle\UserBundle\Mailer\Mailer:
        arguments:
                $mailer: '@swiftmailer.mailer.default'
                $parameters: { confirmation.template: 'test.html.twig',
                               resetting.template: 'test.html.twig',
                               from_email: { confirmation': 'test.html.twig', resetting: 'test.html.twig' }}

    SWP\Bundle\UserBundle\Mailer\MailerInterface: '@SWP\Bundle\UserBundle\Mailer\Mailer'

    SWP\Bundle\UserBundle\Util\TokenGenerator: ~
    SWP\Bundle\UserBundle\Util\TokenGeneratorInterface: '@SWP\Bundle\UserBundle\Util\TokenGenerator'

    SWP\Bundle\UserBundle\Security\LoginManager: ~
    SWP\Bundle\UserBundle\Security\LoginManagerInterface: '@SWP\Bundle\UserBundle\Security\LoginManager'

    SWP\Bundle\UserBundle\EventListener\AuthenticationListener:
        arguments:
            $firewallName: '%swp_user.firewall_name%'
        tags:
            - { name: kernel.event_subscriber }
